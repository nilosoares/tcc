{
   "stages":[
      {
         "$cursor":{
            "query":{
               "$and":[
                  {
                     "shipdate":{
                        "$gt":{
                           "$date":"1997-07-09T00:00:00.000Z"
                        }
                     }
                  },
                  {
                     "shipdate":{
                        "$lt":{
                           "$date":"1997-10-16T00:00:00.000Z"
                        }
                     }
                  }
               ]
            },
            "fields":{
               "discount":1,
               "extendedprice":1,
               "linestatus":1,
               "quantity":1,
               "returnflag":1,
               "tax":1,
               "_id":0
            },
            "queryPlanner":{
               "plannerVersion":1,
               "namespace":"final.deals",
               "indexFilterSet":false,
               "parsedQuery":{
                  "$and":[
                     {
                        "shipdate":{
                           "$lt":{
                              "$date":"1997-10-16T00:00:00.000Z"
                           }
                        }
                     },
                     {
                        "shipdate":{
                           "$gt":{
                              "$date":"1997-07-09T00:00:00.000Z"
                           }
                        }
                     }
                  ]
               },
               "winningPlan":{
                  "stage":"COLLSCAN",
                  "filter":{
                     "$and":[
                        {
                           "shipdate":{
                              "$lt":{
                                 "$date":"1997-10-16T00:00:00.000Z"
                              }
                           }
                        },
                        {
                           "shipdate":{
                              "$gt":{
                                 "$date":"1997-07-09T00:00:00.000Z"
                              }
                           }
                        }
                     ]
                  },
                  "direction":"forward"
               },
               "rejectedPlans":[

               ]
            },
            "executionStats":{
               "executionSuccess":true,
               "nReturned":2443081,
               "executionTimeMillis":125001,
               "totalKeysExamined":0,
               "totalDocsExamined":59986052,
               "executionStages":{
                  "stage":"COLLSCAN",
                  "filter":{
                     "$and":[
                        {
                           "shipdate":{
                              "$lt":{
                                 "$date":"1997-10-16T00:00:00.000Z"
                              }
                           }
                        },
                        {
                           "shipdate":{
                              "$gt":{
                                 "$date":"1997-07-09T00:00:00.000Z"
                              }
                           }
                        }
                     ]
                  },
                  "nReturned":2443081,
                  "executionTimeMillisEstimate":123447,
                  "works":59986054,
                  "advanced":2443081,
                  "needTime":57542972,
                  "needYield":0,
                  "saveState":1,
                  "restoreState":1,
                  "isEOF":1,
                  "invalidates":0,
                  "direction":"forward",
                  "docsExamined":59986052
               },
               "allPlansExecution":[

               ]
            }
         }
      },
      {
         "$group":{
            "_id":{
               "returnflag":"$returnflag",
               "linestatus":"$linestatus"
            },
            "count_order":{
               "$sum":{
                  "$const":1.0
               }
            },
            "sum_qty":{
               "$sum":"$quantity"
            },
            "sum_base_price":{
               "$sum":"$extendedprice"
            },
            "sum_disc_price":{
               "$sum":{
                  "$multiply":[
                     "$extendedprice",
                     {
                        "$subtract":[
                           {
                              "$const":1.0
                           },
                           "$discount"
                        ]
                     }
                  ]
               }
            },
            "sum_charge":{
               "$sum":{
                  "$multiply":[
                     "$extendedprice",
                     {
                        "$subtract":[
                           {
                              "$const":1.0
                           },
                           "$discount"
                        ]
                     },
                     {
                        "$sum":[
                           "$tax",
                           {
                              "$const":1.0
                           }
                        ]
                     }
                  ]
               }
            },
            "sum_disc":{
               "$sum":"$discount"
            }
         }
      },
      {
         "$project":{
            "_id":false,
            "count_order":true,
            "sum_qty":true,
            "sum_base_price":true,
            "sum_disc_price":true,
            "sum_charge":true,
            "returnflag":"$_id.returnflag",
            "linestatus":"$_id.linestatus",
            "avg_qty":{
               "$divide":[
                  "$sum_qty",
                  "$count_order"
               ]
            },
            "avg_price":{
               "$divide":[
                  "$sum_base_price",
                  "$count_order"
               ]
            },
            "avg_disc":{
               "$divide":[
                  "$sum_disc",
                  "$count_order"
               ]
            }
         }
      },
      {
         "$sort":{
            "sortKey":{
               "returnflag":1,
               "linestatus":1
            },
            "limit":1
         }
      }
   ],
   "ok":1.0
}
